<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Code Splitting & Optimization — Notes</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Source+Code+Pro:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg: #fbfdff;
      --surface: #ffffff;
      --muted: #6b7280;
      --accent: #0b69ff;
      --accent-2: #7c3aed;
      --text: #0b1220;
      --code-bg: #0f172a;
      --ok: #16a34a;
      --danger: #ef4444;
      --maxw: 1100px;
      --r:14px;
      --glass: rgba(255,255,255,0.6);
      --shadow: 0 10px 30px rgba(2,6,23,0.08);
    }

    /* Dark mode variables */
    :root.dark{
      --bg: #0b1020;
      --surface: #071021;
      --muted: #9aa4b2;
      --accent: #5cc8ff;
      --accent-2: #b794f4;
      --text: #e6eef8;
      --code-bg: #021025;
      --glass: rgba(10,16,24,0.45);
      --shadow: 0 10px 30px rgba(0,0,0,0.6);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, Arial;
      background:linear-gradient(180deg,var(--bg), rgba(255,255,255,0.02));
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      line-height:1.65;
      padding:28px 18px;
    }

    .wrap{
      max-width:var(--maxw);
      margin:24px auto;
      padding:20px;
    }

    header{
      display:flex;align-items:center;justify-content:space-between;gap:16px;margin-bottom:20px;
    }

    header .brand{display:flex;gap:12px;align-items:center}
    .logo{width:52px;height:52px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;color:white;font-weight:800;font-size:18px;box-shadow:var(--shadow)}

    header h1{margin:0;font-size:20px}
    header .subtitle{color:var(--muted);font-size:13px}

    nav{display:flex;gap:12px;align-items:center}
    a{ color:var(--accent); text-decoration:none; font-weight:600}
    a:hover{ text-decoration:underline }

    .card{background:var(--surface); border-radius:var(--r); padding:22px; box-shadow:var(--shadow); margin-bottom:18px}

    h2{margin-top:0}
    h3{margin-bottom:6px}

    pre{background:var(--code-bg); color:var(--text); padding:14px; border-radius:10px; overflow:auto; font-family: 'Source Code Pro', ui-monospace, SFMono-Regular, Menlo, Monaco, monospace; font-size:13px; line-height:1.45}
    code{background:rgba(0,0,0,0.04); padding:3px 6px; border-radius:6px; font-family: 'Source Code Pro', monospace; font-size:13px}

    ul{padding-left:18px}
    .muted{color:var(--muted)}

    .columns{display:grid;grid-template-columns:1fr 320px;gap:20px}
    @media (max-width:980px){ .columns{grid-template-columns:1fr} }

    .sidebar .card{position:sticky; top:22px}

    .pill{display:inline-block;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:white;padding:6px 10px;border-radius:999px;font-size:12px;margin-right:8px;box-shadow:0 6px 18px rgba(11,105,255,0.12)}

    footer{font-size:13px;color:var(--muted);text-align:center;margin-top:20px}

    /* Table of contents */
    .toc{border-left:1px solid rgba(0,0,0,0.04);padding-left:14px}
    .toc a{display:block;padding:8px 0;color:var(--muted);font-size:14px}
    .toc a:hover{color:var(--accent)}

    /* Toggle */
    .toggle-btn{background:transparent;border:1px solid rgba(0,0,0,0.06);padding:8px 12px;border-radius:999px;cursor:pointer}
    .toggle-btn:hover{filter:brightness(1.04)}

    /* Better readable paragraphs */
    p{max-width:70ch}

    /* subtle divider */
    .divider{height:1px;background:linear-gradient(90deg, rgba(0,0,0,0.04), rgba(0,0,0,0)); margin:18px 0}

  </style>
</head>
<body>
  <div class="wrap" id="pageRoot">
    <header>
      <div class="brand">
        <div class="logo">CS</div>
        <div>
          <h1>Code Splitting & Optimization</h1>
          <div class="subtitle muted">Detailed, practical notes — Webpack, SSR, Module Federation, Performance</div>
        </div>
      </div>

      <nav>
        <a href="index.html">Home</a>
        <button id="themeToggle" class="toggle-btn" aria-label="Toggle theme">Toggle theme</button>
      </nav>
    </header>

    <div class="columns">
      <main>

        <section class="card">
          <h2>1. What code splitting is (precise)</h2>
          <p>Code splitting divides your JavaScript (and associated assets) into multiple <strong>chunks</strong> that load on demand. This speeds up first load and reduces the work the browser must do on initial render.</p>
          <ul>
            <li>Smaller initial payload → faster FCP / LCP</li>
            <li>Lower parse & compile cost → better TTI</li>
            <li>Improved cacheability for stable vendor/runtime chunks</li>
          </ul>
        </section>

        <section class="card">
          <h2>2. Internals: how Webpack creates chunks & runtime</h2>
          <p>Webpack builds a <em>module graph</em> and partitions it at split points into chunks. The runtime bootstrap (in main or a <code>runtime</code> chunk) maps chunk ids→urls and loads chunks on demand.</p>
          <p class="muted">Tip: keep runtime separate (<code>runtimeChunk: 'single'</code>) to stabilize content hashes and improve caching.</p>
        </section>

        <section class="card">
          <h2>3. Ways to create split points</h2>

          <h3>Dynamic <code>import()</code> (recommended)</h3>
          <pre><code>// created at runtime when needed
const mod = await import('./heavy-module');
mod.init();</code></pre>

          <h3><code>React.lazy</code> + <code>Suspense</code></h3>
          <p>Convenient for route/component-level lazy loading. Use <code>@loadable/component</code> for SSR to collect server-side chunks.</p>

          <h3>Magic comments</h3>
          <pre><code>import(/* webpackChunkName: "chart", webpackPrefetch: true */ './chart')</code></pre>
          <ul>
            <li><code>webpackChunkName</code> — friendly chunk filename</li>
            <li><code>webpackPrefetch</code> — low-priority idle-time fetch</li>
            <li><code>webpackPreload</code> — high-priority fetch (use sparingly)</li>
          </ul>

          <h3>Static multiple entries (MPA)</h3>
          <p>Useful for separate pages/apps where each entry is an independent bundle.</p>
        </section>

        <section class="card">
          <h2>4. SplitChunksPlugin — deep dive</h2>
          <p>Use <code>optimization.splitChunks</code> to extract common modules. Key knobs:</p>
          <ul>
            <li><code>chunks</code>: <code>all</code> (recommended)</li>
            <li><code>cacheGroups</code>: group node_modules or common components</li>
            <li><code>minSize</code>, <code>maxSize</code>, <code>minChunks</code></li>
          </ul>

          <pre><code>optimization: {
  splitChunks: {
    chunks: 'all',
    minSize: 20000,
    maxSize: 244000,
    cacheGroups: {
      vendors: { test: /node_modules/, name: 'vendors', priority: -10 },
      commons: { test: /src\/components/, minChunks: 2, name: 'commons' }
    }
  }
}</code></pre>

          <p class="muted">Balance: more split points → smaller bytes but more requests. Test with HTTP/2 and on slow networks.</p>
        </section>

        <section class="card">
          <h2>5. Runtime chunk & long-term caching</h2>
          <p>Use <code>runtimeChunk: 'single'</code> and <code>moduleIds: 'deterministic'</code> with content-hash filenames to avoid unnecessary cache invalidation.</p>
          <pre><code>output: {
  filename: 'js/[name].[contenthash:8].js',
  chunkFilename: 'js/[name].[contenthash:8].chunk.js'
}
optimization: { runtimeChunk: 'single', moduleIds: 'deterministic' }</code></pre>
        </section>

        <section class="card">
          <h2>6. Preload vs Prefetch vs Preconnect</h2>
          <ul>
            <li><code>&lt;link rel="preload"&gt;</code> — high priority for current navigation</li>
            <li><code>&lt;link rel="prefetch"&gt;</code> — low priority, idle-time for likely next nav</li>
            <li><code>&lt;link rel="preconnect"&gt;</code> — warm up DNS/TCP/TLS to CDNs</li>
          </ul>
        </section>

        <section class="card">
          <h2>7. SSR & async chunks</h2>
          <p>SSR must include async chunk scripts used during render. Use <code>@loadable/component</code> to collect chunks server-side and inject scripts for hydration.</p>
          <p class="muted">React.lazy alone won't work for SSR; it can't collect chunk info during server render.</p>
        </section>

        <section class="card">
          <h2>8. Module Federation & code splitting</h2>
          <ul>
            <li>Keep <code>remoteEntry.js</code> minimal — heavy code in lazy chunks</li>
            <li>Code-split inside remotes to avoid large initial downloads</li>
            <li>Share singletons (React) to prevent duplication and context bugs</li>
          </ul>
        </section>

        <section class="card">
          <h2>9. Debugging & diagnostics</h2>
          <ul>
            <li>Bundle analyze (webpack-bundle-analyzer) for host & remotes</li>
            <li>Network waterfall & WebPageTest for chunk timings</li>
            <li>DevTools Performance for parse/execute profiling</li>
            <li>Use RUM for LCP/parse durations in the wild</li>
          </ul>
        </section>

        <section class="card">
          <h2>10. Production-ready config (concise)</h2>
          <pre><code>// snippets only
const MiniCssExtractPlugin = require('mini-css-extract-plugin');
const CssMinimizerPlugin = require('css-minimizer-webpack-plugin');
const TerserPlugin = require('terser-webpack-plugin');

module.exports = {
  mode: 'production',
  output: { filename: 'js/[name].[contenthash:8].js', chunkFilename: 'js/[name].[contenthash:8].chunk.js' },
  optimization: {
    runtimeChunk: 'single',
    moduleIds: 'deterministic',
    splitChunks: { chunks: 'all', minSize: 20000, maxSize: 244000 },
    minimizer: [new TerserPlugin({parallel:true}), new CssMinimizerPlugin()]
  },
  plugins:[ new MiniCssExtractPlugin({filename:'css/[name].[contenthash:8].css'}) ]
}
</code></pre>
        </section>

        <section class="card">
          <h2>11. Checklist & quick fixes</h2>
          <ul>
            <li>Convert heavy routes/components to <code>import()</code> / <code>React.lazy</code></li>
            <li>Keep <code>remoteEntry.js</code> tiny in MF contexts</li>
            <li>Use <code>runtimeChunk: 'single'</code> and deterministic ids</li>
            <li>Run bundle analyzer and add CI size checks</li>
            <li>Precompress artifacts (.br/.gz) in CI and serve via CDN</li>
          </ul>
        </section>

      </main>

      <aside class="sidebar">
        <div class="card">
          <h3>Contents</h3>
          <nav class="toc">
            <a href="#">1 — What is code splitting</a>
            <a href="#">2 — Internals</a>
            <a href="#">3 — Split points</a>
            <a href="#">4 — SplitChunks</a>
            <a href="#">5 — Runtime & caching</a>
          </nav>
        </div>

        <div class="card">
          <h3>Quick tips</h3>
          <ul>
            <li>Measure both network & CPU (parse/execute)</li>
            <li>Avoid thousands of tiny chunks</li>
            <li>Use prefetch for high-probability navigations only</li>
          </ul>
        </div>

        <div class="card">
          <h3>Metadata</h3>
          <p class="muted">Updated: 2025-11-16</p>
          <p class="muted">Format: HTML note</p>
        </div>
      </aside>
    </div>

    <footer class="muted">© 2025 Your Notes — add this file as <code>code-splitting.html</code> to your repo and link from index.html</footer>
  </div>

  <script>
    // Theme toggle with persistence; respect system preference
    (function(){
      const root = document.documentElement;
      const stored = localStorage.getItem('theme');
      const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      function applyTheme(theme){
        if(theme === 'dark') root.classList.add('dark'); else root.classList.remove('dark');
      }
      if(stored) applyTheme(stored); else applyTheme(prefersDark ? 'dark' : 'light');

      const btn = document.getElementById('themeToggle');
      btn.addEventListener('click', ()=>{
        const active = root.classList.contains('dark') ? 'dark' : 'light';
        const next = active === 'dark' ? 'light' : 'dark';
        applyTheme(next);
        localStorage.setItem('theme', next);
      });
    })();
  </script>
</body>
</html>
